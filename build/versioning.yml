jobs:
- job: SetupAndRun
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - task: DownloadBuildArtifacts@0
    inputs:
      buildType: 'current'
      downloadType: 'single'
      downloadPath: '$(System.ArtifactsDirectory)'
      artifactName: 'deploy'

  - task: PowerShell@2
    displayName: 'Detect API Breaking Changes'
    inputs:
      filepath: '$(System.DefaultWorkingDirectory)/samples/scripts/PowerShell/GenerateOpenApiYaml.ps1'
      arguments: >
        -WorkingDir '$(System.ArtifactsDirectory)'
        -OutputPathofDll 'src/Microsoft.Health.Dicom.Web/bin/$(buildConfiguration)/net5.0/Microsoft.Health.Dicom.Web.dll'
        -Version 'v1-prerelease'
