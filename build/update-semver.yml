steps:
- task: UseDotNet@2
  displayName: 'Use .NET Core 5.x'
  inputs:
    packageType: sdk
    version: 5.x

- task: PowerShell@2
  name: 'GitVersion'
  displayName: 'Run GitVersion'
  inputs:
    targetType: 'inline'
    script: |
      dotnet new tool-manifest
      dotnet tool install GitVersion.Tool --version 5.6.6 --configfile nuget.config
      $GitVersion = dotnet tool run dotnet-gitversion /config GitVersion.yml /output json /nofetch | ConvertFrom-Json

      Write-Host "##vso[task.setvariable variable=semVer]$(GitVersion.semVer)"
      Write-Host "##vso[task.setvariable variable=informationalVersion;isOutput=true]$(GitVersion.informationalVersion)"
      Write-Host "##vso[task.setvariable variable=majorMinorPatch;isOutput=true]$(GitVersion.majorMinorPatch)"
      Write-Host "##vso[task.setvariable variable=nuGetVersion;isOutput=true]$(GitVersion.semVer)"
      Write-Host "##vso[task.setvariable variable=assemblySemVer;isOutput=true]$(GitVersion.assemblySemVer)"
      Write-Host "##vso[task.setvariable variable=assemblySemFileVer;isOutput=true]$(GitVersion.assemblySemFileVer)"
    failOnStderr: true
    showWarnings: true
    pwsh: true
    workingDirectory: '$(Build.SourcesDirectory)'

- powershell: |
    Write-Host '----------Variables to use for build----------'
    Write-Host 'semVer: $(semVer)'
    Write-Host 'informationalVersion: $(informationalVersion)'
    Write-Host 'majorMinorPatch: $(majorMinorPatch)'
    Write-Host 'assemblySemVer: $(assemblySemVer)'
    Write-Host 'assemblySemFileVer: $(assemblySemFileVer)'
    Write-Host 'nuGetVersion: $(nuGetVersion)'
  name: PrintVariablesFromGitVersion
